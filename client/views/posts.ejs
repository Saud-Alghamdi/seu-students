<html dir="<%=langDirection%>">
  <head>
    <%- include('partials/head.ejs') %>
    <title><%=langData.postsPage_TITLE%></title>
  </head>
  <body class="d-flex flex-column gap-4">
    <%- include('partials/nav.ejs') %>

    <main class="posts-page-container__main position-relative flex-grow-1 text-center text-light">
      <!-- Back link -->
      <a class="text-light text-decoration-none position-absolute" id="back-link" onclick="history.back()">
        <i class="fa-sharp fa-solid fa-arrow-right-long"></i>
      </a>

      <header>
        <h1><%=langData.postsPage_POSTS%> <%=courseCode%>:</h1>
      </header>

      <form class="mt-3" action="./add-post" method="GET">
        <button class="add-post-btn btn btn-primary"><%=langData.postsPage_ADD_POST%></button>
      </form>

      <!-- if post added successfully -->
      <% if(typeof user !== 'undefined' && typeof postSuccess !== 'undefined') { %>
      <script>
        showToast(true, "<%= langData.toast_ADD_POST_SUCCESS %>");
      </script>
      <% } %>

      <!-- If user clicked on Add Post while he is not logged in -->
      <% if(typeof needLogin !== 'undefined') { %>
      <script>
        showToast(false, "<%= langData.toast_MUST_LOGIN_TO_ADD_POST %>");
      </script>
      <% } %>

      <div class="posts-flex-container mt-4 d-flex justify-content-center flex-wrap text-dark px-md-5">
        <% if(typeof posts !== 'undefined' && posts.length > 0) { %> <% posts.forEach(post => { %>
        <a class="fileLink text-decoration-none d-block" href="/downloadFile?s3FileName=<%= post.s3FileName %>&title=<%= post.title %>" download="<%= post.s3FileName %>">
          <div class="posts-page-container__post d-flex flex-column border-dark rounded-4 px-3 m-2 shadow-lg">
            <div class="posts-page-container__post-column d-flex justify-content-start align-items-center flex-grow-1">
              <% if(post.fileType === '.pdf') { %>
              <img class="post-file-icon" src="/images/pdf-icon.svg" alt="" height="30" width="30" />
              <% } else if (post.fileType === '.doc' || post.fileType === '.docx') { %>
              <img class="post-file-icon" src="/images/word-icon.svg" alt="" height="30" width="30" />
              <% } else if (post.fileType === '.ppt' || post.fileType === '.pptx') { %>
              <img class="post-file-icon" src="/images/powerpoint-icon.svg" alt="" height="30" width="30" />
              <% } %>
              <h6 class="post-title text-end fw-bolder d-inline mx-2"><%= post.title %></h6>
            </div>
            <div class="posts-page-container__post-column d-flex justify-content-start align-items-center flex-grow-1">
              <% if (post.gender === 'male') { %>
              <img class="post-user-icon" src="/images/male-icon.svg" alt="Placeholder" width="25" height="25" />
              <% } else if (post.gender === 'female') { %>
              <img class="post-user-icon" src="/images/female-icon.svg" alt="Placeholder" width="25" height="25" />
              <% } %>
              <small class="post-username d-inline my-0 mx-2"><%= post.username %></small>
            </div>
            <div class="posts-page-container__post-column d-flex justify-content-start align-items-center flex-grow-1">
              <small class="post-date"><%= post.createdAt %></small>
            </div>
          </div>
        </a>
        <% })} else { %>
        <h6 class="text-light"><%=langData.postsPage_NO_POSTS%></h6>
        <% } %>
      </div>

      <div class="pagination d-flex flex-row-reverse justify-content-center align-items-center mt-5">
        <% if(totalPages !== 'undefined') { %> <% for (let i = 1; i <= totalPages; i++) { %> <% if(i === currentPage) { %>
        <a href="?page=<%= i %>" class="page-number-link text-light mx-2"><%= i %></a>
        <% } else { %>
        <a href="?page=<%= i %>" class="page-number-link text-decoration-none text-light mx-2"><%= i %></a>
        <% } %> <% } %> <% } %>
      </div>
    </main>

    <%- include('partials/footer.ejs') %>
  </body>
</html>
